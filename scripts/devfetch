#!/usr/bin/env bash
# devfetch — Sung Jinwoo ASCII art (left) + neofetch-style system info (right)

# ── Colors ──────────────────────────────────────────────────────
R='\e[1;31m'; G='\e[1;32m'; B='\e[1;34m'
Y='\e[1;33m'; C='\e[1;36m'; M='\e[1;35m'
W='\e[1;37m'; DIM='\e[2;37m'; N='\e[0m'
BM='\e[0;35m'   # dim purple  — shadow/dark areas
BW='\e[2;37m'   # dim white   — outlines & cracks
LM='\e[1;35m'   # bright magenta — aura glow & eyes

# ── System info helpers ──────────────────────────────────────────
_cpu() {
    grep -m1 "model name" /proc/cpuinfo 2>/dev/null \
      | cut -d: -f2 \
      | sed 's/^ *//; s/(R)//g; s/(TM)//g; s/  */ /g; s/ @.*//' \
      | cut -c1-30
}

_ram() {
    local t a
    t=$(awk '/MemTotal/     { print $2 }' /proc/meminfo 2>/dev/null)
    a=$(awk '/MemAvailable/ { print $2 }' /proc/meminfo 2>/dev/null)
    [ -n "$t" ] && printf "%d MiB / %d MiB" $(( (t-a)/1024 )) $(( t/1024 )) || echo "—"
}

_uptime() { uptime -p 2>/dev/null | sed 's/^up //' || echo '—'; }

_host_model() {
    wmic computersystem get model /format:value 2>/dev/null \
      | grep -i "^Model=" | cut -d= -f2 | tr -d '\r\n' \
      || echo "${COMPUTERNAME:-unknown}"
}

_gpu() {
    wmic path Win32_VideoController get name /format:value 2>/dev/null \
      | grep -i "^Name=" | head -1 | cut -d= -f2 | tr -d '\r\n' \
      | cut -c1-30 \
      || echo "unknown"
}

_resolution() {
    local w h
    w=$(wmic path Win32_VideoController get CurrentHorizontalResolution /format:value \
          2>/dev/null | grep -o '[0-9]\+' | head -1)
    h=$(wmic path Win32_VideoController get CurrentVerticalResolution /format:value \
          2>/dev/null | grep -o '[0-9]\+' | head -1)
    [ -n "$w" ] && echo "${w}x${h}" || echo "unknown"
}

_packages() {
    local n
    n=$(ls -1 "${_DEVSHELL_DIR}/scripts" 2>/dev/null | wc -l)
    echo "${n} (devshell)"
}

_terminal() {
    if   [ -n "$WT_SESSION" ];    then echo "Windows Terminal"
    elif [ -n "$TERM_PROGRAM" ];  then echo "$TERM_PROGRAM"
    elif [ -n "$TERM" ];          then echo "$TERM"
    else                               echo "Git Bash"
    fi
}

# ── Gather data ──────────────────────────────────────────────────
    _user="${USER:-user}"
    _host="${HOSTNAME%%.*}"
    _kernel=$(uname -r 2>/dev/null)
    _sh="bash ${BASH_VERSION%%\(*}"
     _cpu_str="$(_cpu)"
    _ram_str="$(_ram)"
    _up="$(_uptime)"
    _host_model="$(_host_model)"
    _gpu_str="$(_gpu)"
    _res="$(_resolution)"
    _pkgs="$(_packages)"
    _term="$(_terminal)"

# ── Label helper — consistent "Label:" width ─────────────────────
# Usage: _lbl "Label:" "value"
_lbl() { printf "${C}%-12s${N}%s" "$1" "$2"; }

# ── Info lines (right column, starts at column 36) ───────────────
info=(
    "                   ${G}${_user}${N}${DIM}@${N}${G}${_host}${N}"
    "                   ${DIM}─────────────────────────────${N}"
    "                   $(_lbl 'OS:'         "Windows 10 x86_64")"
    "                   $(_lbl 'Host:'       "${_host_model}")"
    "                   $(_lbl 'Kernel:'     "${_kernel}")"
    "                   $(_lbl 'Uptime:'     "${_up}")"
    "                   $(_lbl 'Packages:'   "${_pkgs}")"
    "                   $(_lbl 'Shell:'      "${_sh}")"
    "                   $(_lbl 'Resolution:' "${_res}")"
    "                   $(_lbl 'Terminal:'   "${_term}")"
    "                   $(_lbl 'CPU:'        "${_cpu_str}")"
    "                   $(_lbl 'GPU:'        "${_gpu_str}")"
    "                   $(_lbl 'Memory:'     "${_ram_str}")"
    ""
    "" "" "" "" "" "" "" "" "" "" "" "" "" ""
)

# ── Sung Jinwoo — Shadow Monarch ASCII art (left column) ─────────
#
#  Based on: dark cracked armor, glowing purple eyes,
#  X-shaped white lightning on chest, daggers in both hands,
#  purple aura and shadow tendrils surrounding the figure.
#
art=(
#  Row 1-3 · floating particles + shadow tendrils
    "  ${C}·${N}  ${M}✦${N}  ${C}·${N} ${M}✦${N}  ${C}·${N}  ${M}✦${N}  ${C}·${N}  ${M}✦${N}  ${C}·${N}  "
    " ${BM}╭╮${N} ${BM}╭─╮${N}  ${BM}╭──────╮${N}  ${BM}╭─╮${N} ${BM}╭╮${N} "
    "${BM}╭╯╰──╯ ╰──╯${N}  ${BM}╭────╮${N}  ${BM}╰──╯ ╰──╯ ╰╮${N}"
#  Row 4-6 · spiky hair
    "${BW}╱${N} ${BM}╭╮${N} ${BM}╭──╯${N}  ${BM}╭──────╮${N}  ${BM}╰──╮${N} ${BM}╭╮${N} ${BW}╲${N}"
    "${BW}│${N}${BM}╭╯╰──╯${N}  ${BM}╭╯${N}  ${BM}╭──╮${N}  ${BM}╰╮${N}  ${BM}╰──╯╰╮${N}${BW}│${N}"
    "${BW}│${N}${BM}│${N}      ${BM}│${N}  ${BM}│${N}  ${BM}│${N}  ${BM}│${N}      ${BM}│${N}${BW}│${N}"
#  Row 7-11 · face (dim frame, glowing purple eyes)
    "${BW}│${N}${BM}│${N}     ${BM}╭╯${N}  ${BM}│${N}  ${BM}│${N}  ${BM}╰╮${N}     ${BM}│${N}${BW}│${N}"
    "${BW}│${N}${BM}│${N}    ${BM}│${N}   ${LM}◈${N}    ${LM}◈${N}   ${BM}│${N}    ${BM}│${N}${BW}│${N}"
    "${BW}│${N}${BM}│${N}    ${BM}│${N}    ${BW}─ ─ ─${N}    ${BM}│${N}    ${BM}│${N}${BW}│${N}"
    "${BW}│${N}${BM}│${N}    ${BM}│${N}   ${BW}╰──────╯${N}   ${BM}│${N}    ${BM}│${N}${BW}│${N}"
    "${BW}│${N}${BM}│${N}     ${BM}╰─────────────────╯${N}     ${BM}│${N}${BW}│${N}"
#  Row 12-13 · neck → shoulders
    "${BW}│${N}  ${BM}╰──────────────────────────╯${N}  ${BW}│${N}"
    "${BW}╲${N}      ${BM}╔══════════════════╗${N}      ${BW}╱${N}"
#  Row 14-20 · chest with X-shaped lightning
    "  ${BM}╲${N}   ${BM}║${N}${BW}╲${N}               ${BW}╱${N}${BM}║${N}   ${BM}╱${N}  "
    "   ${BM}╲${N}  ${BM}║${N} ${BW}╲${N}    ${M}✦${N}     ${BW}╱${N} ${BM}║${N}  ${BM}╱${N}   "
    "    ${BM}╲${N} ${BM}║${N}  ${BW}╲${N}   ${W}╱╲${N}  ${BW}╱${N}  ${BM}║${N} ${BM}╱${N}    "
    "     ${BM}╲${N}${BM}║${N}   ${BW}╲${N} ${W}╱${N}${Y}★${N}${W}╲${N} ${BW}╱${N}   ${BM}║${N}${BM}╱${N}     "
    "    ${BM}╱${N} ${BM}║${N}  ${BW}╱${N}   ${W}╲╱${N}  ${BW}╲${N}  ${BM}║${N} ${BM}╲${N}    "
    "   ${BM}╱${N}  ${BM}║${N} ${BW}╱${N}    ${M}✦${N}     ${BW}╲${N} ${BM}║${N}  ${BM}╲${N}   "
    "  ${BM}╱${N}   ${BM}║${N}${BW}╱${N}               ${BW}╲${N}${BM}║${N}   ${BM}╲${N}  "
#  Row 21-22 · lower armor + daggers
    "      ${BM}║${N}  ${BM}▓▓▓▓▓▓▓▓▓▓▓▓▓${N}  ${BM}║${N}      "
    "${M}⚡${N}${W}══╗${N} ${BM}╚╗${N} ${BM}▓▓▓▓▓▓▓▓▓▓▓▓▓${N} ${BM}╔╝${N} ${W}╔══${N}${M}⚡${N}"
#  Row 23-28 · legs fading into shadow mist
    "   ${BM}╰╯${N}  ${BM}▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓${N}  ${BM}╰╯${N}   "
    "       ${BM}▓▓▓▓▓▓${N}   ${BM}▓▓▓▓▓▓${N}       "
    "      ${BM}░▓▓▓▓▓${N}     ${BM}▓▓▓▓▓░${N}      "
    "     ${BM}░░░░░░░${N}     ${BM}░░░░░░░${N}     "
    "    ${BM}░░░░░░░░░░░░░░░░░░░░░░${N}    "
    "   ${BM}░░░░░░░░░░░░░░░░░░░░░░░░${N}   "
)

# ── Side-by-side renderer ────────────────────────────────────────
# \e[36G = Cursor Horizontal Absolute → jumps to column 36 regardless
# of how many invisible ANSI codes are in the art line.
_row() {
    printf "  %b" "$1"
    printf "\e[36G"
    printf "%b\n" "$2"
}

# ── Main ─────────────────────────────────────────────────────────
echo ""
max=$(( ${#art[@]} > ${#info[@]} ? ${#art[@]} : ${#info[@]} ))
for (( i=0; i<max; i++ )); do
    _row "${art[$i]:-}" "${info[$i]:-}"
    sleep 0.04
done
echo ""
