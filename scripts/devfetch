#!/usr/bin/env bash
# devfetch — DevShell system info + Sung Jinwoo (Shadow Monarch) ASCII art
#            Displayed side-by-side on shell startup.

# ── Colors ──────────────────────────────────────────────────────
R='\e[1;31m'; G='\e[1;32m'; B='\e[1;34m'
Y='\e[1;33m'; C='\e[1;36m'; M='\e[1;35m'
W='\e[1;37m'; DIM='\e[2;37m'; N='\e[0m'

# ── System info helpers ──────────────────────────────────────────
_cpu() {
    grep -m1 "model name" /proc/cpuinfo 2>/dev/null \
      | cut -d: -f2 \
      | sed 's/^ *//; s/(R)//g; s/(TM)//g; s/  */ /g; s/ @.*//'
}

_ram() {
    local t a
    t=$(awk '/MemTotal/     { print $2 }' /proc/meminfo 2>/dev/null)
    a=$(awk '/MemAvailable/ { print $2 }' /proc/meminfo 2>/dev/null)
    [ -n "$t" ] && printf "%d MiB / %d MiB" $(( (t-a)/1024 )) $(( t/1024 )) || echo "—"
}

_uptime() { uptime -p 2>/dev/null | sed 's/^up //' || echo '—'; }

# ── Gather data ──────────────────────────────────────────────────
_user="${USER:-user}"
_host="${HOSTNAME%%.*}"
_kernel=$(uname -r 2>/dev/null | sed 's/-.*//')
_os="Windows 10  (kernel ${_kernel})"
_sh="Bash ${BASH_VERSION%%\(*}"
_cpu_str="$(_cpu)"
_ram_str="$(_ram)"
_up="$(_uptime)"
_root="$(basename "${_DEVSHELL_DIR:-.}")"

# ── Info lines (left column) ─────────────────────────────────────
info=(
    "${G}${_user}${N}${DIM}@${N}${G}${_host}${N}"
    "${DIM}────────────────────────────────${N}"
    "${C}OS      ${N}${_os}"
    "${C}Shell   ${N}${_sh}"
    "${C}CPU     ${N}${_cpu_str}"
    "${C}RAM     ${N}${_ram_str}"
    "${C}Uptime  ${N}${_up}"
    "${C}Root    ${N}${_root}"
    ""
    "${R}██${Y}██${G}██${C}██${B}██${M}██${W}██${N}  palette"
    ""
    ""
    ""
    ""
)

# ── Sung Jinwoo — Shadow Monarch ASCII art (right column) ────────
#
#        · ★ · ★ · ★ ·
#       ╱‾‾‾‾‾‾‾‾‾‾‾‾‾╲
#      │  ◈           ◈ │
#      │    ─ ─ ─ ─ ─   │
#      │    ╰─────────╯  │
#       ╲▂▂▂▂▂▂▂▂▂▂▂▂▂╱
#      ╔═══════════════════╗
#      ║ ▓▓  SHADOW   ▓▓▓  ║
#      ║ ▓▓  MONARCH  ▓▓▓  ║
#      ║    [ A R I S E ]   ║
#      ╚══════════╤═════════╝
#                 │
#               ╱ │ ╲
#             ╱   │   ╲

art=(
    "${C}    · ★  · ★  · ★  ·${N}"
    "${DIM}     ╱‾‾‾‾‾‾‾‾‾‾‾‾‾‾╲${N}"
    "${DIM}    │${N}  ${M}◈${N}            ${M}◈${N}  ${DIM}│${N}"
    "${DIM}    │${N}    ${W}─ ─ ─ ─ ─${N}    ${DIM}│${N}"
    "${DIM}    │${N}    ${W}╰─────────╯${N}    ${DIM}│${N}"
    "${DIM}     ╲▂▂▂▂▂▂▂▂▂▂▂▂▂▂╱${N}"
    "${DIM}    ╔════════════════════╗${N}"
    "${DIM}    ║${N} ${M}▓▓${N}  ${W}SHADOW  ${N} ${M}▓▓▓${N}  ${DIM}║${N}"
    "${DIM}    ║${N} ${M}▓▓${N}  ${W}MONARCH ${N} ${M}▓▓▓${N}  ${DIM}║${N}"
    "${DIM}    ║${N}   ${Y}[ A R I S E ]${N}    ${DIM}║${N}"
    "${DIM}    ╚══════════╤═════════╝${N}"
    "${DIM}               │${N}"
    "${DIM}             ╱ │ ╲${N}"
    "${DIM}           ╱   │   ╲${N}"
)

# ── Side-by-side renderer ────────────────────────────────────────
# Uses Cursor Horizontal Absolute (\e[NG) to jump to a fixed column
# for the art, so ANSI codes in the left column don't break alignment.
_row() {
    printf "  "
    printf "%b" "$1"
    printf "\e[48G"   # jump to column 48 for the art
    printf "%b\n" "$2"
}

# ── Main ─────────────────────────────────────────────────────────
echo ""
max=$(( ${#info[@]} > ${#art[@]} ? ${#info[@]} : ${#art[@]} ))
for (( i=0; i<max; i++ )); do
    _row "${info[$i]:-}" "${art[$i]:-}"
    sleep 0.04
done
echo ""
